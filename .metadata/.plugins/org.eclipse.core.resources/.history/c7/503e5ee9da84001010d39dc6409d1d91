/*
 * crc32.c â€” Standard CRC-32 (Ethernet) reflected, poly=0x04C11DB7
 * init=0xFFFFFFFF, xorout=0xFFFFFFFF, same as ESP32 side.
 */
#include "boot.h"

uint32_t crc32_update(uint32_t crc, const void* data, uint32_t len) {
    const uint8_t* p = (const uint8_t*)data;
    crc = ~crc;
    for (uint32_t i = 0; i < len; ++i) {
        crc ^= p[i];
        for (int b = 0; b < 8; ++b) {
            uint32_t mask = -(crc & 1u);
            crc = (crc >> 1) ^ (0xEDB88320u & mask);
        }
    }
    return ~crc;
}
